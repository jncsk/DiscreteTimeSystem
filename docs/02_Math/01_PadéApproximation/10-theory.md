# 行列指数関数の数値解析 -理論編-

<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [行列指数関数の数値解析 -理論編-](#行列指数関数の数値解析--理論編-)
  - [0. 初めに](#0-初めに)
  - [1. 行列指数関数の定義](#1-行列指数関数の定義)
  - [2. 数値解析方法](#2-数値解析方法)
    - [テイラー展開とパデ近似の比較](#テイラー展開とパデ近似の比較)
  - [3. テイラー展開の次数固定による誤差](#3-テイラー展開の次数固定による誤差)
  - [4. パデ近似（Padé approximation）](#4-パデ近似padé-approximation)
    - [4.1 近似条件](#41-近似条件)
    - [4.2 係数決定の手順](#42-係数決定の手順)
  - [5. 例：$[1/1]$ 型パデ近似で $e^x$ を近似](#5-例11-型パデ近似で-ex-を近似)
  - [6. 行列指数関数におけるPade近似](#6-行列指数関数におけるpade近似)
    - [6.1. 近似式の制約条件](#61-近似式の制約条件)
    - [6.2. 係数公式（Padé 係数）](#62-係数公式padé-係数)
    - [6.3 $V$ と $U$ への変形](#63-v-と-u-への変形)

<!-- /code_chunk_output -->


## 0. 初めに
本章では、行列指数関数の数値解析手法を理論面から解説する。

---

## 1. 行列指数関数の定義

行列指数関数 $e^{A_ct}$ は以下のように定義される。

$$
\begin{aligned}
e^{A_c t} &= I + A_c t + A_c^2 t^2 \frac{1}{2!} + \dots + A_c^n t^n \frac{1}{n!} + \dots \\
&= \sum_{n=0}^\infty A_c^n t^n \frac{1}{n!}
\tag{1}
\end{aligned}
$$

この定義は、スカラーの指数関数 $e^x$ のテイラー展開

$$
\begin{aligned}
e^x = \sum_{n=0}^\infty \frac{x^n}{n!}
\tag{2}
\end{aligned}
$$

をそのまま行列に拡張したものである。  
行列の累乗や加法、スカラー倍は定義可能であり、級数は任意の正方行列に対して収束するため、この定義が成立する。

## 2. 数値解析方法
式 (1) を数値的に計算する方法として、代表的に次の二つがある。
1. **テイラー展開**  
   定義式 (1) をそのまま有限項で打ち切って計算する方法。多項式近似であり、展開点付近では高精度だが、**高次が必要になると計算コストや数値誤差が増える。**

2. **パデ近似**  
   指数関数を、分子と分母がそれぞれ多項式である有理関数の形に近似する方法。少ない次数で広い範囲の精度を確保でき、数値安定性にも優れるため、**行列指数関数の計算ではこちらが一般的に用いられる。**



### テイラー展開とパデ近似の比較

| 項目 | テイラー展開 | パデ近似 |
|------|--------------|----------|
| 近似の形 | 多項式（足し算だけ） | 有理関数（多項式の比） |
| 特徴 | 展開点（原点）付近で高精度 | 広い範囲で精度を保ちやすい |
| 必要な次数 | 原点から離れるほど高次数が必要 | 同じ精度なら低次数で済む |
| 数値安定性 | 高次になると誤差が蓄積しやすい | 比較的安定しやすい |
| 行列計算での使われ方 | 小さい行列や教材用で使用 | 実務で一般的に使用される |

---

## 3. テイラー展開の次数固定による誤差
テイラー展開を用いた行列指数関数の計算で、次数を固定（例：3次）すると、展開点（原点）から離れるにつれて誤差が急増する。
例として、スカラー関数 \( e^x \) を3次のマクローリン展開で近似すると次のようになる。

$$
\begin{equation}
    \begin{aligned}
        e^x \approx 1 + x + \frac{x^2}{2!} + \frac{x^3}{3!}
    \end{aligned}
\tag{3}
\end{equation}
$$

- $x = 1$ の場合  
  近似値 $\approx 2.6667$、真値 \( \approx 2.7183 \)、相対誤差 ≈ **1.9%**  
  → 高精度で実用上問題ない。
- \(x = 10\) の場合  
  近似値 \( \approx 227.667 \)、真値 \( \approx 22026.465 \)、相対誤差 ≈ **99%**  
  → 高次項の寄与が無視できず、精度が大幅に低下。

**結論:**  
次数固定のテイラー展開は原点付近では十分な精度を持つが、離れると高次項を無視できなくなり、誤差が急増する。

---

## 4. パデ近似（Padé approximation）
パデ近似は、関数 $ f(x) $ を次のような有理関数で近似する。
$$
\begin{equation}
    \begin{aligned}
R_{m,n}(x) = \frac{P_m(x)}{Q_n(x)} = \frac{\sum_{k=0}^m a_k x^k}{\sum_{k=0}^n b_k x^k}, \quad b_0 = 1
    \end{aligned}
\tag{4}
\end{equation}
$$

ここで \(m\) と \(n\) は、それぞれ分子・分母の多項式の次数を表す。

---

### 4.1 近似条件
パデ近似は、ある関数 \( f(x) \) のテイラー展開と、有理関数 \( R_{m,n}(x) \) の展開が **できるだけ多くの項で一致する**ように係数 \(a_k\)、\(b_k\) を決める。

つまり、

$$
\begin{equation}
    \begin{aligned}
f(x) - R_{m,n}(x) = \mathcal{O}\left(x^{m+n+1}\right) \quad (x \to 0)
    \end{aligned}
\tag{5}
\end{equation}
$$

となるように係数を選ぶ。  

> **補足：Big-O記法について**  
> \(\mathcal{O}(x^p)\) (Big-O記法) は「誤差の大きさ（オーダー）」を簡潔に表す記号である。
>パデ近似では「原点付近で何次までテイラー展開が一致し、何次から誤差が現れるか」を示している。
これは「x が小さいとき、誤差は定数$C$と$|x|^k$の積で上から抑えられる」という意味になる。
厳密には次のように定義される。 
$$
\begin{equation}
    \begin{aligned}
     f(x) - R_{m,n}(x) = \mathcal{O}(x^{m+n+1})
    \end{aligned}
\tag{6}
\end{equation}
$$
これは、次の条件と同値である：
$$
\begin{equation}
    \begin{aligned}
     |f(x) - R_{m,n}(x)| \leq C\,|x|^k,
     \quad \text{for } |x| < \delta
    \end{aligned}
\tag{7}
\end{equation}
$$
>ここで$C$は誤差の係数（定数倍のスケール）であり、近似方法や関数形によって決まる。
>$\delta$はこの誤差評価が有効な範囲を示す。
>$k$は誤差が現れ始める次数を表す。

---

### 4.2 係数決定の手順
1. $P_m(x) = a_0 + a_1 x + \dots + a_m x^m$  
   $Q_n(x) = 1 + b_1 x + \dots + b_n x^n$ とおく
2. $R_{m,n}(x) = \frac{P_m(x)}{Q_n(x)}$ をテイラー展開
3. 元の関数 $f(x)$ のテイラー展開と係数を比較
4. 連立方程式を解いて $a_k, b_k$ を決定

---

## 5. 例：$[1/1]$ 型パデ近似で $e^x$ を近似
**(1) 元の関数のテイラー展開**  
$$
\begin{equation}
    \begin{aligned}
    e^x = 1 + x + \frac{x^2}{2} + \mathcal{O}(x^3)
    \end{aligned}
\tag{7}
\end{equation}
$$

**(2) 近似式の作成**  
$$
\begin{equation}
    \begin{aligned}
    R_{1,1}(x) = \frac{a_0 + a_1 x}{1 + b_1 x}
    \end{aligned}
\tag{8}
\end{equation}
$$

**(3) 近似式のテイラー展開**
> **等比級数展開**
> - 分母の逆数を展開するため、等比級数展開の公式を使う：
> - 等比級数展開の公式
> 初項が $1$、公比が $u$ の等比数列の和は次式で表される (実際に計算をしてみると成り立つので、気になれば手計算をしてみるべし)。
$$
\begin{equation}
    \begin{aligned}
    \frac{1-u^n}{1-u} = 1+u+u^2+\dots+u^{n-1}=\sum_{k=0}^n u^k
    \end{aligned}
\tag{9}
\end{equation}
$$
$|u| < 1$ のとき、$n \to \infty$ では $u^n \to 0$ となるため、式 (9) は以下のようになる：
$$
\begin{equation}
    \begin{aligned}
    \frac{1}{1 - u} = 1 + u + u^2 + \dots
    \end{aligned}
\tag{10}
\end{equation}
$$

   式 (10) において、\(u = -b_1 x\) とすると：
$$
\begin{equation}
    \begin{aligned}
   \frac{1}{1 + b_1 x} = 1 - b_1 x + b_1^2 x^2 - \dots
    \end{aligned}
\tag{11}
\end{equation}
$$
これを式 (8) に代入し、$x^2$まで整理する。
$$
\begin{equation}
    \begin{aligned}
          R_{1,1}(x) &= (a_0 + a_1 x)(1 - b_1 x + b_1^2 x^2 + \dots) \\
           &= a_0 + (a_1 - a_0 b_1) x + (a_0 b_1^2 - a_1 b_1) x^2 + \mathcal{O}(x^3)
    \end{aligned}
\tag{12}
\end{equation}
$$

**(5) 係数比較**  
$$
\begin{equation}
    \begin{aligned}
    a_0 = 1,\quad a_1 - b_1 = 1,\quad b_1^2 - a_1 b_1 = \frac12
    \end{aligned}
\tag{13}
\end{equation}
$$
これを解くと
$$
\begin{equation}
    \begin{aligned}
    b_1 = -\frac12,\quad a_1 = \frac12
    \end{aligned}
    \tag{14}
\end{equation}
$$

**(6) 完成**  
$$
\begin{equation}
    \begin{aligned}
R_{1,1}(x) = \frac{1 + \frac12 x}{1 - \frac12 x}
    \end{aligned}
    \tag{15}
\end{equation}
$$


---

## 6. 行列指数関数におけるPade近似
行列指数関数におけるPade近似式は以下のように表される。

$$
R_m(x) = \frac{P_m(x)}{Q_m(x)} = (V+U)(V-U)^{-1}
\tag{16}
$$

これを以下で導出する。

---

### 6.1. 近似式の制約条件

指数関数 $e^x$ は次の性質を持つ。

1. **偶数次項と奇数次項に分けられる**

   $$
   e^x =
   \left( 1 + \frac{x^2}{2!} + \frac{x^4}{4!} + \cdots \right) +
   \left( \frac{x}{1!} + \frac{x^3}{3!} + \frac{x^5}{5!} + \cdots \right)
   \tag{17}
   $$

2. **反転対称性**

   $$
   e^{-x} = \frac{1}{e^x} 
   \tag{18}
   $$

Padé 近似にも上記の性質を反映させるため、次の条件を課す：

$$
R_m(-x) \approx \frac{1}{R_m(x)}
\tag{19}
$$

そのために分子・分母の多項式を

$$
Q_m(x) = P_m(-x)
\tag{20}
$$

と対称な形に設定する。つまり、

$$
P_m(x) = \sum_{j=0}^m a_j x^j,\quad
Q_m(x) = \sum_{j=0}^m a_j (-x)^j
\tag{21}
$$

とする。さらに Padé 近似の一致条件

$$
Q_m(x)e^x - P_m(x) = O(x^{2m+1})
\tag{22}
$$

を満たすように $a_j$ を決定する。
そのためにテイラー展開

$$
e^x = \sum_{k=0}^\infty \frac{x^k}{k!}
\tag{23}
$$

を代入し、$x^k$ の係数が $k=0,1,\dots,2m$ でゼロになるように $a_j$ を決定する。

---

### 6.2. 係数公式（Padé 係数）

解くと、係数は階乗比で次のように表される。

$$
a_j = \frac{(2m-j)!\; m!}{(2m)!\; j!\; (m-j)!}, \quad j=0,1,\dots,m
\tag{24}
$$

これを

$$
c_j^{(m)} = a_j
\tag{25}
$$

とすれば、行列の場合は

$$
P_m(A) = \sum_{j=0}^m c_j^{(m)} A^j,\quad
Q_m(A) = \sum_{j=0}^m c_j^{(m)} (-A)^j
\tag{26}
$$

となる。

> **注**：ここでの $c_j^{(m)}$ は **Padé 係数**であり、テイラー展開の係数 $1/k!$ とは異なる。
> 無限級数の係数は $1/k!$ だが、有限次 Padé 近似では近似精度を最大化するために異なる値になる。

---

### 6.3 $V$ と $U$ への変形
Padé 多項式を偶数次と奇数次に分解すると、次の2つの行列多項式が得られる：
* **$V_m$** : 偶数次の項（係数 $c_{2j}^{(m)}$）
  $$
  V_m = c_0^{(m)}I + c_2^{(m)}A^2 + c_4^{(m)}A^4 + \dots
  \tag{27}
  $$

* **$U_m$** : 奇数次の項（係数 $c_{2j+1}^{(m)}$）
  $$
  U_m = c_1^{(m)}A + c_3^{(m)}A^3 + \dots
  \tag{28}
  $$

このとき、
$$
P_m(x) = V + U,\quad Q_m(x) = V - U
\tag{28}
$$

が必ず成り立つ。したがって近似式は

$$
R_m(x) = \frac{P_m(x)}{Q_m(x)} = (V+U)(V-U)^{-1}
\tag{29}
$$

という偶奇分解形で表せる。

---

