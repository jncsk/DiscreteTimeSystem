
## 1. 元の Padé 近似の形

スカラー関数 $f(x)$ の Padé 近似は、関数を有理関数で近似する手法で、次の形をとる。

$$
R_{m,n}(x) = \frac{P_m(x)}{Q_n(x)} 
= \frac{\sum_{k=0}^m a_k x^k}{\sum_{k=0}^n b_k x^k}, 
\quad b_0 = 1
\tag{1}
$$

近似したい関数のテイラー展開の係数と比較して、係数 $a_k, b_k$ を決める。

---

## 2. 指数関数の性質と設計方針

指数関数 $e^x$ は次の性質を持つ。

1. **偶数次項と奇数次項に分けられる**

   $$
   e^x =
   \left( 1 + \frac{x^2}{2!} + \frac{x^4}{4!} + \cdots \right) +
   \left( \frac{x}{1!} + \frac{x^3}{3!} + \frac{x^5}{5!} + \cdots \right)
   $$

2. **反転対称性**

   $$
   e^{-x} = \frac{1}{e^x} 
   $$

---

## 3. 多項式の形の仮定と条件設定

指数関数の特性を近似式にも持たせるために、

$$
R_m(-x) \approx \frac{1}{R_m(x)}
$$

が成り立つように、Padé 近似の多項式 $Q(x), P(x)$ に次の制約を課す。

$$
Q_m(x) = P_m(-x)
$$

これにより、未知係数が $m+1$ 個に減り、計算が簡潔になる。

係数 $a_j$ を未知数として

$$
P_m(x) = \sum_{j=0}^m a_j x^j,\quad
Q_m(x) = \sum_{j=0}^m a_j (-x)^j
$$

と仮定する。Padé 近似の一致条件

$$
Q_m(x)e^x - P_m(x) = O(x^{2m+1})
$$

にテイラー展開

$$
e^x = \sum_{k=0}^\infty \frac{x^k}{k!}
$$

を代入し、$x^k$ の係数が $k=0,1,\dots,2m$ でゼロになるように $a_j$ を決定する。

---

## 4. 係数公式（Padé 係数）

解くと、係数は階乗比で次のように表される。

$$
a_j = \frac{(2m-j)!\; m!}{(2m)!\; j!\; (m-j)!}, \quad j=0,1,\dots,m
$$

これを

$$
c_j^{(m)} = a_j
$$

とすれば、行列の場合は

$$
P_m(A) = \sum_{j=0}^m c_j^{(m)} A^j,\quad
Q_m(A) = \sum_{j=0}^m c_j^{(m)} (-A)^j
$$

となる。

> **注**：ここでの $c_j^{(m)}$ は **Padé 係数**であり、テイラー展開の係数 $1/k!$ とは異なる。
> 無限級数の係数は $1/k!$ だが、有限次 Padé 近似では近似精度を最大化するために異なる値になる。

---

## 5. $V$ と $U$ への変形

$Q_m(x) = P_m(-x)$ から、偶数次項は符号がそのまま、奇数次項は符号が反転する。よって

$$
P_m(x) = V + U,\quad Q_m(x) = V - U
$$

が必ず成り立ち、

$$
R_m(x) = \frac{P_m(x)}{Q_m(x)} = (V+U)(V-U)^{-1}
$$

という偶奇分解形が成立する。

行列の場合も同様に、

$$
P_m(A) = V_m + U_m, \quad Q_m(A) = V_m - U_m
$$

* **$V_m$** : 偶数次の項（係数 $c_{2j}^{(m)}$）

  $$
  V_m = c_0^{(m)}I + c_2^{(m)}A^2 + c_4^{(m)}A^4 + \dots
  $$
* **$U_m$** : 奇数次の項（係数 $c_{2j+1}^{(m)}$）

  $$
  U_m = c_1^{(m)}A + c_3^{(m)}A^3 + \dots
  $$

---

## 1. これまで説明してきた係数 $c_j^{(m)}$

私たちが導出してきたのは

$$
c_j^{(m)} = \frac{(2m-j)!\,m!}{(2m)!\,j!\,(m-j)!}
$$

で、

$$
P_m(x) = \sum_{j=0}^m c_j^{(m)}\,x^j
$$

という形。
これは **$c_0^{(m)}=1$** という正規化になっていて、分子・分母の定数項が 1 から始まる形です。

---

## 2. MATLAB/Higham 実装の係数 $b_j$

MATLAB や Higham の実装では、係数の表現を

$$
P_m(x) = \sum_{j=0}^m b_j\,x^j
$$

としていて、このときの $b_j$ は

$$
b_j = c_j^{(m)} \cdot \frac{(2m)!}{m!}
$$

になっています。

このスケール因子 $\frac{(2m)!}{m!}$ は、**分母と分子の両方に同じ定数倍を掛けた**だけです。
有理関数 $R_m(x) = P_m(x)/Q_m(x)$ の値は、分子と分母に同じ定数倍をしても変わらないので、近似自体は同じです。

---

## 3. なぜこんなスケーリングをするのか

実装的な理由は次の通りです。

* **整数係数にできる**
  このスケーリングをすると $b_j$ がきれいな整数になります（120, 60, 12, ... のように）。
  これなら事前に定数としてハードコードしやすく、丸め誤差も少なく済みます。
* **冪乗計算での安定性改善**
  $b_j$ が極端に小さい値や分数だと、行列累乗の加算時に桁落ちしやすいですが、大きめの整数にしておくと相対誤差が減ります。
* **古い Fortran 実装との互換性**
  Higham の `expm` 実装や古い文献では、この整数形式がよく使われています。

---

## 4. まとめると

* $c_j^{(m)}$ … 理論導出時に自然に出てくる係数（$c_0=1$ の正規化）
* $b_j$ … 実装上扱いやすくするために $\frac{(2m)!}{m!}$ 倍した係数（整数化）
* 両者の近似式は**全く同じ**（分子・分母を同じ定数倍しているだけ）

---

もし希望があれば、この **$c_j^{(m)}$ と $b_j$ の対応表（m=3,5,7,9,13）** を作って見せられます。
そうすれば「スケーリングしただけ」というのが一目で分かります。
作りますか？
