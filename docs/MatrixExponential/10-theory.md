# 行列指数関数の数値解析 -理論編-

<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [行列指数関数の数値解析 -理論編-](#行列指数関数の数値解析--理論編-)
  - [0. 初めに](#0-初めに)
  - [1. 行列指数関数の定義](#1-行列指数関数の定義)
  - [2. 数値解析方法](#2-数値解析方法)
    - [テイラー展開とパデ近似の比較](#テイラー展開とパデ近似の比較)
  - [3. テイラー展開の次数固定による誤差](#3-テイラー展開の次数固定による誤差)
  - [4. パデ近似（Padé approximation）](#4-パデ近似padé-approximation)
    - [4.1 近似条件](#41-近似条件)
    - [4.2 係数決定の手順](#42-係数決定の手順)
  - [5. 例：$[1/1]$ 型パデ近似で $e^x$ を近似](#5-例11-型パデ近似で-ex-を近似)

<!-- /code_chunk_output -->


## 0. 初めに
本章では、行列指数関数の数値解析手法を理論面から解説する。

---

## 1. 行列指数関数の定義

行列指数関数 $e^{A_ct}$ は以下のように定義される。

$$
\begin{aligned}
e^{A_c t} &= I + A_c t + A_c^2 t^2 \frac{1}{2!} + \dots + A_c^n t^n \frac{1}{n!} + \dots \\
&= \sum_{n=0}^\infty A_c^n t^n \frac{1}{n!}
\tag{1}
\end{aligned}
$$

この定義は、スカラーの指数関数 $e^x$ のテイラー展開

$$
e^x = \sum_{n=0}^\infty \frac{x^n}{n!}
\tag{2}
$$

をそのまま行列に拡張したものである。  
行列の累乗や加法、スカラー倍は定義可能であり、級数は任意の正方行列に対して収束するため、この定義が成立する。

## 2. 数値解析方法
式 (1) を数値的に計算する方法として、代表的に次の二つがある。
1. **テイラー展開**  
   定義式 (1) をそのまま有限項で打ち切って計算する方法。多項式近似であり、展開点付近では高精度だが、**高次が必要になると計算コストや数値誤差が増える。**

2. **パデ近似**  
   指数関数を、分子と分母がそれぞれ多項式である有理関数の形に近似する方法。少ない次数で広い範囲の精度を確保でき、数値安定性にも優れるため、**行列指数関数の計算ではこちらが一般的に用いられる。**

---

### テイラー展開とパデ近似の比較

| 項目 | テイラー展開 | パデ近似 |
|------|--------------|----------|
| 近似の形 | 多項式（足し算だけ） | 有理関数（多項式の比） |
| 特徴 | 展開点（原点）付近で高精度 | 広い範囲で精度を保ちやすい |
| 必要な次数 | 原点から離れるほど高次数が必要 | 同じ精度なら低次数で済む |
| 数値安定性 | 高次になると誤差が蓄積しやすい | 比較的安定しやすい |
| 行列計算での使われ方 | 小さい行列や教材用で使用 | 実務で一般的に使用される |

---

## 3. テイラー展開の次数固定による誤差
テイラー展開を用いた行列指数関数の計算で、次数を固定（例：3次）すると、展開点（原点）から離れるにつれて誤差が急増する。
例として、スカラー関数 \( e^x \) を3次のマクローリン展開で近似すると次のようになる。

$$
\begin{equation}
    \begin{aligned}
        e^x \approx 1 + x + \frac{x^2}{2!} + \frac{x^3}{3!}
    \end{aligned}
\tag{3}
\end{equation}
$$

- $x = 1$ の場合  
  近似値 $\approx 2.6667$、真値 \( \approx 2.7183 \)、相対誤差 ≈ **1.9%**  
  → 高精度で実用上問題ない。
- \(x = 10\) の場合  
  近似値 \( \approx 227.667 \)、真値 \( \approx 22026.465 \)、相対誤差 ≈ **99%**  
  → 高次項の寄与が無視できず、精度が大幅に低下。

**結論:**  
次数固定のテイラー展開は原点付近では十分な精度を持つが、離れると高次項を無視できなくなり、誤差が急増する。

## 4. パデ近似（Padé approximation）
パデ近似は、関数 $ f(x) $ を次のような有理関数で近似する。
\[
R_{m,n}(x) = \frac{P_m(x)}{Q_n(x)} = \frac{\sum_{k=0}^m a_k x^k}{\sum_{k=0}^n b_k x^k}, \quad b_0 = 1
\tag{4}
\]
ここで \(m\) と \(n\) は、それぞれ分子・分母の多項式の次数を表す。

---

### 4.1 近似条件
パデ近似は、ある関数 \( f(x) \) のテイラー展開と、有理関数 \( R_{m,n}(x) \) の展開が **できるだけ多くの項で一致する**ように係数 \(a_k\)、\(b_k\) を決める。

つまり、

\[
f(x) - R_{m,n}(x) = \mathcal{O}\left(x^{m+n+1}\right) \quad (x \to 0)
\tag{5}
\]

となるように係数を選ぶ。  

> **補足：Big-O記法について**  
> \(\mathcal{O}(x^p)\) (Big-O記法) は「誤差の大きさ（オーダー）」を簡潔に表す記号である。
>パデ近似では「原点付近で何次までテイラー展開が一致し、何次から誤差が現れるか」を示している。
これは「x が小さいとき、誤差は定数$C$と$|x|^k$の積で上から抑えられる」という意味になる。
厳密には次のように定義される。 
$$
\begin{equation}
    \begin{aligned}
     f(x) - R_{m,n}(x) = \mathcal{O}(x^{m+n+1})
    \end{aligned}
\tag{6}
\end{equation}
$$
これは、次の条件と同値である：
$$
\begin{equation}
    \begin{aligned}
     |f(x) - R_{m,n}(x)| \leq C\,|x|^k,
     \quad \text{for } |x| < \delta
    \end{aligned}
\tag{7}
\end{equation}
$$
>ここで$C$は誤差の係数（定数倍のスケール）であり、近似方法や関数形によって決まる。
>$\delta$はこの誤差評価が有効な範囲を示す。
>$m+n+1$ が、誤差が現れ始める次数を表す。

---

### 4.2 係数決定の手順
1. $P_m(x) = a_0 + a_1 x + \dots + a_m x^m$  
   $Q_n(x) = 1 + b_1 x + \dots + b_n x^n$ とおく
2. $R_{m,n}(x) = \frac{P_m(x)}{Q_n(x)}$ をテイラー展開
3. 元の関数 $f(x)$ のテイラー展開と係数を比較
4. 連立方程式を解いて $a_k, b_k$ を決定

---

## 5. 例：$[1/1]$ 型パデ近似で $e^x$ を近似
**(1) 元の関数のテイラー展開**  
$$
e^x = 1 + x + \frac{x^2}{2} + \mathcal{O}(x^3)
\tag{7}
$$

**(2) 近似式の作成**  
$$
R_{1,1}(x) = \frac{a_0 + a_1 x}{1 + b_1 x}
\tag{8}
$$

**(3) 近似式のテイラー展開**
> **等比級数展開**
> - 分母の逆数を展開するため、等比級数展開の公式を使う：
> - 等比級数展開の公式
> 初項が $1$、公比が $u$ の等比数列の和は次式で表される (実際に計算をしてみると成り立つので、気になれば手計算をしてみるべし)。
\[
\frac{1-u^n}{1-u} = 1+u+u^2+\dots+u^{n-1}=\sum_{k=0}^n u^k
\tag{9}
\]
$|u| < 1$ のとき、$n \to \infty$ では $u^n \to 0$ となるため、式 (9) は以下のようになる：
   \[
   \frac{1}{1 - u} = 1 + u + u^2 + \dots
   \tag{10}
   \]

   式 (10) において、\(u = -b_1 x\) とすると：
   \[
   \frac{1}{1 + b_1 x} = 1 - b_1 x + b_1^2 x^2 - \dots
   \tag{11}
   \]
これを式 (8) に代入する。
$$
\begin{equation}
    \begin{aligned}
R_{1,1}(x) &= (a_0 + a_1 x)(1 - b_1 x + b_1^2 x^2 + \dots) \\
           &= a_0 + (a_1 - a_0 b_1) x + (a_0 b_1^2 - a_1 b_1) x^2 + \mathcal{O}(x^3)
    \end{aligned}
\tag{12}
\end{equation}
$$

**(5) 係数比較**  
$$
a_0 = 1,\quad a_1 - b_1 = 1,\quad b_1^2 - a_1 b_1 = \frac12
\tag{13}
$$
これを解くと
$$
b_1 = -\frac12,\quad a_1 = \frac12
\tag{14}
$$

**(6) 完成**  
$$
R_{1,1}(x) = \frac{1 + \frac12 x}{1 - \frac12 x}
\tag{15}
$$

